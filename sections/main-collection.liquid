{%- liquid
  assign collection = collection | default: collections.all
  assign products_per_page = section.settings.products_per_page | default: 12
  assign enable_sorting = section.settings.enable_sorting
  assign enable_filtering = section.settings.enable_filtering
-%}

<section class="main-collection section" data-collection-id="{{ collection.id }}">
  <div class="container">
    <!-- Collection Header -->
    <div class="main-collection__header">
      <div class="main-collection__header-content">
        {%- if collection.title != blank -%}
          <h1 class="main-collection__title">{{ collection.title }}</h1>
        {%- endif -%}
        {%- if collection.description != blank -%}
          <div class="main-collection__description">
            {{ collection.description }}
          </div>
        {%- endif -%}
      </div>

      {%- if enable_sorting -%}
        <div class="main-collection__sort">
          <label for="SortBy-{{ section.id }}" class="main-collection__sort-label visually-hidden">
            Sort by
          </label>
          <select
            name="sort_by"
            id="SortBy-{{ section.id }}"
            class="main-collection__sort-select"
            data-sort-select
          >
            {%- for option in collection.sort_options -%}
              <option value="{{ option.value }}" {% if option.value == collection.sort_by %}selected{% endif %}>
                {{ option.name }}
              </option>
            {%- endfor -%}
          </select>
        </div>
      {%- endif -%}
    </div>

    <!-- Product Count -->
    <div class="main-collection__count">
      <p>
        {%- if collection.products_count == 0 -%}
          No products found
        {%- elsif collection.products_count == 1 -%}
          1 product
        {%- else -%}
          {{ collection.products_count }} products
        {%- endif -%}
      </p>
    </div>

    <!-- Product Grid -->
    {%- if collection.products_count > 0 -%}
      {%- paginate collection.products by products_per_page -%}
        <div class="main-collection__grid">
          {%- for product in collection.products -%}
            {% render 'product-card', product: product %}
          {%- endfor -%}
        </div>

        <!-- Pagination -->
        {%- if paginate.pages > 1 -%}
          <div class="main-collection__pagination">
            <nav class="pagination" role="navigation" aria-label="Pagination">
              <ul class="pagination__list">
                {%- if paginate.previous -%}
                  <li class="pagination__item">
                    <a href="{{ paginate.previous.url }}" class="pagination__link pagination__link--prev" aria-label="Previous page">
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      <span class="visually-hidden">Previous</span>
                    </a>
                  </li>
                {%- else -%}
                  <li class="pagination__item">
                    <span class="pagination__link pagination__link--disabled" aria-disabled="true">
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      <span class="visually-hidden">Previous</span>
                    </span>
                  </li>
                {%- endif -%}

                {%- for part in paginate.parts -%}
                  {%- if part.is_link -%}
                    <li class="pagination__item">
                      <a href="{{ part.url }}" class="pagination__link" aria-label="Page {{ part.title }}">
                        {{ part.title }}
                      </a>
                    </li>
                  {%- else -%}
                    {%- if part.title == paginate.current_page -%}
                      <li class="pagination__item">
                        <span class="pagination__link pagination__link--current" aria-current="page" aria-label="Page {{ part.title }}">
                          {{ part.title }}
                        </span>
                      </li>
                    {%- else -%}
                      <li class="pagination__item">
                        <span class="pagination__link pagination__link--ellipsis">
                          {{ part.title }}
                        </span>
                      </li>
                    {%- endif -%}
                  {%- endif -%}
                {%- endfor -%}

                {%- if paginate.next -%}
                  <li class="pagination__item">
                    <a href="{{ paginate.next.url }}" class="pagination__link pagination__link--next" aria-label="Next page">
                      <span class="visually-hidden">Next</span>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </a>
                  </li>
                {%- else -%}
                  <li class="pagination__item">
                    <span class="pagination__link pagination__link--disabled" aria-disabled="true">
                      <span class="visually-hidden">Next</span>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </span>
                  </li>
                {%- endif -%}
              </ul>
            </nav>
          </div>
        {%- endif -%}
      {%- endpaginate -%}
    {%- else -%}
      <div class="main-collection__empty">
        <p class="main-collection__empty-text">No products in this collection.</p>
        <a href="{{ routes.all_products_collection_url }}" class="main-collection__empty-link button">
          Continue shopping
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

<style>
  .main-collection {
    padding: var(--spacing-xl) 0;
  }

  .main-collection__header {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-lg);
    border-bottom: 1px solid var(--color-chrome-silver);
  }

  @media (min-width: 768px) {
    .main-collection__header {
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-start;
    }
  }

  .main-collection__header-content {
    flex: 1;
  }

  .main-collection__title {
    font-family: var(--font-heading);
    font-size: clamp(2rem, 4vw, 3rem);
    color: var(--color-championship-white);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin: 0 0 var(--spacing-sm) 0;
    line-height: 1.2;
  }

  .main-collection__description {
    font-size: 1rem;
    line-height: 1.7;
    color: var(--color-chrome-silver);
    max-width: 800px;
  }

  .main-collection__description p {
    margin-bottom: var(--spacing-sm);
  }

  .main-collection__sort {
    flex-shrink: 0;
  }

  .main-collection__sort-label {
    display: block;
    margin-bottom: var(--spacing-xs);
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-championship-white);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .main-collection__sort-select {
    min-width: 200px;
    padding: var(--spacing-sm) var(--spacing-md);
    font-size: 0.9375rem;
    background-color: transparent;
    border: 1px solid var(--color-chrome-silver);
    color: var(--color-championship-white);
    cursor: pointer;
    transition: border-color var(--transition-base);
  }

  .main-collection__sort-select:focus {
    border-color: var(--color-victory-red);
    outline: none;
  }

  .main-collection__count {
    margin-bottom: var(--spacing-lg);
    font-size: 0.9375rem;
    color: var(--color-chrome-silver);
  }

  .main-collection__grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
  }

  @media (max-width: 639px) {
    .main-collection__grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-md);
    }
  }

  .main-collection__empty {
    text-align: center;
    padding: var(--spacing-2xl) var(--spacing-md);
  }

  .main-collection__empty-text {
    font-size: 1.125rem;
    color: var(--color-chrome-silver);
    margin-bottom: var(--spacing-lg);
  }

  .main-collection__empty-link {
    display: inline-block;
  }

  .main-collection__pagination {
    margin-top: var(--spacing-xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-chrome-silver);
  }

  .pagination {
    display: flex;
    justify-content: center;
  }

  .pagination__list {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .pagination__item {
    margin: 0;
  }

  .pagination__link {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    padding: 0 var(--spacing-sm);
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--color-championship-white);
    text-decoration: none;
    border: 1px solid transparent;
    transition: all var(--transition-base);
  }

  .pagination__link:hover:not(.pagination__link--disabled):not(.pagination__link--current) {
    border-color: var(--color-victory-red);
    color: var(--color-victory-red);
  }

  .pagination__link--current {
    background-color: var(--color-victory-red);
    border-color: var(--color-victory-red);
    color: var(--color-championship-white);
    cursor: default;
  }

  .pagination__link--disabled {
    opacity: 0.3;
    cursor: not-allowed;
    color: var(--color-chrome-silver);
  }

  .pagination__link--ellipsis {
    cursor: default;
    color: var(--color-chrome-silver);
  }

  .pagination__link--prev,
  .pagination__link--next {
    padding: 0 var(--spacing-md);
  }
</style>

<script>
  (function() {
    const sortSelect = document.querySelector('[data-sort-select]');
    if (!sortSelect) return;

    sortSelect.addEventListener('change', function() {
      const url = new URL(window.location.href);
      url.searchParams.set('sort_by', this.value);
      window.location.href = url.toString();
    });
  })();
</script>

{% schema %}
{
  "name": "Main collection",
  "tag": "section",
  "class": "section-main-collection",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 24,
      "step": 4,
      "default": 12,
      "label": "Products per page"
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable sorting",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "label": "Enable filtering",
      "default": false,
      "info": "Filtering will be available in a future update"
    }
  ],
  "presets": [
    {
      "name": "Main collection"
    }
  ]
}
{% endschema %}

